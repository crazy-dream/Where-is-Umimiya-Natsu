<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>猜猜小丑在哪裡 - 修好 cooldown 版</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #bfe8ff;
    font-family: "Microsoft JhengHei", sans-serif;
}

/* -------------------- Story Player -------------------- */
#storyPlayer {
    position: fixed;
    inset: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
}

#storyPlayer img {
    width: 100vw;
    height: 100vh;
    object-fit: cover;
}

#storyHint {
    position: absolute;
    right: 20px;
    bottom: 20px;
    color: white;
    font-size: 28px;
    font-weight: bold;
    user-select: none;
}

/* -------------------- Game Area -------------------- */
#gameArea {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: flex-end;
    padding-bottom: 80px;
}

/* 回合數 */
#roundText {
    position: fixed;
    top: 10px;
    right: 20px;
    font-size: 30px;
    font-weight: bold;
    color: #002d55;
}

/* -------------------- Doors -------------------- */
.doors {
    display: flex;
    gap: 60px;
}

.door {
    width: 180px;
    height: 300px;
    position: relative;
    cursor: pointer;
}

/* 門前面 */
.door-front {
    position: absolute;
    inset: 0;
    background: #2a84d6;
    border: 4px solid #003d7a;
    border-radius: 6px;
    transform-origin: left;
    transition: transform 0.8s ease;
}

/* 門後圖片 */
.door-back {
    position: absolute;
    inset: 0;
    background: #fff;
    border-radius: 6px;
    overflow: hidden;
}

.door-back img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* 門打開 */
.door.open .door-front {
    transform: rotateY(-95deg);
}

/* -------------------- WIN / GAME OVER -------------------- */
.overlayText {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    font-size: 120px;
    font-weight: 900;
    color: red;
    text-shadow: 0 0 40px red;
    pointer-events: none;
}
</style>
</head>

<body>

<!-- -------------------- 開場故事 -------------------- -->
<div id="storyPlayer">
    <img id="storyImg" src="story/洋芋片1.jpg">
    <div id="storyHint">點擊任意地方繼續</div>
</div>

<!-- -------------------- 遊戲區 -------------------- -->
<div id="gameArea">
    <div id="roundText">Round: 1</div>

    <div class="doors">
        <div class="door" data-id="0">
            <div class="door-back"><img src="joker/1.png"></div>
            <div class="door-front"></div>
        </div>

        <div class="door" data-id="1">
            <div class="door-back"><img src="joker/2.png"></div>
            <div class="door-front"></div>
        </div>

        <div class="door" data-id="2">
            <div class="door-back"><img src="joker/3.png"></div>
            <div class="door-front"></div>
        </div>
    </div>
</div>

<!-- 結果 -->
<div id="winText" class="overlayText">WIN</div>
<div id="loseText" class="overlayText">GAME OVER</div>

<script>
/* -------------------- Story Player -------------------- */
const storyImgs = [
    "story/洋芋片1.jpg",
    "story/洋芋片2.jpg",
    "story/洋芋片3.jpg",
    "story/洋芋片4.jpg",
    "story/洋芋片5.jpg",
    "story/洋芋片6.jpg"
];

let storyIndex = 0;
const storyPlayer = document.getElementById("storyPlayer");
const storyImg = document.getElementById("storyImg");

storyPlayer.addEventListener("click", () => {
    storyIndex++;
    if (storyIndex < storyImgs.length) {
        storyImg.src = storyImgs[storyIndex];
    } else {
        storyPlayer.style.display = "none";
        document.getElementById("gameArea").style.display = "flex";
    }
});

/* -------------------- Game Logic -------------------- */

let round = 1;
const roundText = document.getElementById("roundText");

const doors = document.querySelectorAll(".door");
const jokerImgs = ["joker/1.png", "joker/2.png", "joker/3.png"];

let jokerPos = Math.floor(Math.random() * 3);
let canClick = true;

/* 更新門後的圖片 */
function refreshJokerImage() {
    // next random
    jokerPos = Math.floor(Math.random() * 3);

    doors.forEach((door, i) => {
        const img = door.querySelector(".door-back img");
        if (i === jokerPos) {
            img.src = jokerImgs[Math.floor(Math.random() * jokerImgs.length)];
        } else {
            img.src = "joker/empty.png"; // 你可以放空門圖片，或你自己的
        }
    });
}

refreshJokerImage();

/* -------------------- 點門事件 -------------------- */
doors.forEach(door => {
    door.addEventListener("click", () => {
        if (!canClick) return;
        canClick = false;

        const id = Number(door.dataset.id);

        door.classList.add("open");

        // 等門開完再判斷
        door.addEventListener("transitionend", function openHandler() {

            // 第一次 transitionend＝門開完
            door.removeEventListener("transitionend", openHandler);

            if (id === jokerPos) {
                document.getElementById("loseText").style.display = "flex";
            } else {
                round++;
                roundText.innerHTML = "Round: " + round;

                // 關門（開始）
                door.classList.remove("open");

                /* -------------------- ★ 修復後的 cooldown ★ -------------------- */
                // 門開始關 → 等門關好後才能按
                door.addEventListener("transitionend", function closeHandler() {
                    door.removeEventListener("transitionend", closeHandler);

                    // 門完全關閉 → 下一張圖才換
                    refreshJokerImage();

                    // 門關完 → 立刻能按
                    canClick = true;
                });
                /* ----------------------------------------------------------------- */
            }
        });
    });
});
</script>

</body>
</html>
