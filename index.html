<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>çŒœçŒœå°ä¸‘åœ¨å“ªè£¡</title>

<style>
:root{
  --bg:#bfe8ff;
  --door:#3aa0ff;
  --accent:#ff4b6e;
  --text:#002d59;
  --red:#ff3b3b;
  --win:#1E90FF;
}
html,body{height:100%; margin:0; font-family:"Microsoft JhengHei",sans-serif; background:var(--bg);}
body{overflow:hidden;}

/* =============================== */
/* å…¨è¢å¹•æ•…äº‹æ’­æ”¾å€                */
/* =============================== */
#storyPlayer{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  z-index:99999;
  cursor:pointer;
}
#storyImg{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
}
#storyHint{
  position:absolute;
  right:30px;
  top:50%;
  transform:translateY(-50%);
  writing-mode:vertical-rl;
  font-size:32px;
  font-weight:700;
  color:white;
  user-select:none;
}

/* =============================== */
/* åŸæœ¬çš„éŠæˆ²                      */
/* =============================== */
.game-wrap{min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:28px; gap:18px;}
header{width:100%; display:flex; justify-content:center; position:relative;}
h1{margin:0;font-size:28px;}
.level-badge{position:absolute; left:18px; top:0; padding:6px 10px; border-radius:10px;
  font-weight:700; background:rgba(255,255,255,0.25); backdrop-filter: blur(4px);} 
.lives{position:absolute; right:18px; top:0; display:flex; gap:8px;} 
.life{width:18px; height:18px; border-radius:50%; background:var(--red);} 
.life.empty{background:#eee; border:1px solid #aaa;} 

.stage{display:flex; gap:32px; justify-content:center; margin-top:20px;} 

.door-card{
  width:540px; height:420px; background:var(--door);
  border-radius:16px; position:relative; overflow:hidden; cursor:pointer;
  transition:0.2s;
}

@keyframes shake {
  0%{ transform:translateX(0);} 
  20%{ transform:translateX(-12px);} 
  40%{ transform:translateX(12px);} 
  60%{ transform:translateX(-8px);} 
  80%{ transform:translateX(8px);} 
  100%{ transform:translateX(0);} 
}
.shake{ animation:shake 0.4s ease; }

.reveal-area{position:absolute; inset:0; z-index:1; display:flex; justify-content:center; align-items:center;} 
.reveal-img{max-width:100%; max-height:100%; object-fit:cover;} 

.panel{position:absolute; z-index:10; width:50%; top:0; bottom:0; display:flex;
  justify-content:center; align-items:center; font-size:60px; font-weight:900;
  background:var(--door); transition:0.75s;} 
.panel.left{ left:0; } 
.panel.right{ right:0; } 
.door-card.open .panel.left{ transform:translateX(-100%); } 
.door-card.open .panel.right{ transform:translateX(100%); } 

.pop-clown{
  position:fixed;
  left:50%; top:50%;
  transform:translate(-50%,-50%) scale(0.1);
  font-size:40px;
  opacity:0.2;
  z-index:9999;
  animation:pop 0.9s ease-out forwards;
}
@keyframes pop {
  0% { transform:translate(-50%,-50%) scale(0.1); opacity:0; }
  40%{ transform:translate(-50%,-50%) scale(3.0); opacity:0.7; }
  100%{ transform:translate(-50%,-50%) scale(4.0); opacity:0; }
}

.overlay{position:fixed; inset:0; display:flex; justify-content:center;
  align-items:center; background:rgba(0,0,0,0); pointer-events:none;
  z-index:999; transition:0.3s;} 
.overlay-message{opacity:0; font-size:70px; font-weight:900; color:red; transition:0.3s;} 
.overlay.show{background:rgba(0,0,0,0.65); pointer-events:auto;} 
.overlay.show .overlay-message{opacity:1;} 
</style>
</head>

<body>

<!-- ======================= -->
<!--   æ•…äº‹æ’­æ”¾ç³»çµ±          -->
<!-- ======================= -->
<div id="storyPlayer">
  <img id="storyImg" />
  <div id="storyHint">é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ</div>
</div>

<!-- ======================= -->
<!--        éŠæˆ²æœ¬é«”         -->
<!-- ======================= -->
<div class="game-wrap" id="gameArea" style="display:none;">
  <header>
    <div class="level-badge" id="levelBadge">ç¬¬1é—œ</div>
    <h1>çŒœçŒœå°ä¸‘åœ¨å“ªè£¡</h1>
    <div class="lives">
      <div class="life" id="life1"></div>
      <div class="life" id="life2"></div>
      <div class="life" id="life3"></div>
    </div>
  </header>

  <div class="stage">
    <div class="door-card" id="doorA">
      <div class="reveal-area"><img id="imgA" class="reveal-img"></div>
      <div class="panel left">ğŸ¤¡</div>
      <div class="panel right">ğŸ¤¡</div>
    </div>
    <div class="door-card" id="doorB">
      <div class="reveal-area"><img id="imgB" class="reveal-img"></div>
      <div class="panel left">ğŸ¤¡</div>
      <div class="panel right">ğŸ¤¡</div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-message" id="overlayMsg">GAME OVER</div>
</div>

<script>
/* ======================================================== */
/*                 æ•… äº‹ æ’­ æ”¾ é‚ è¼¯                       */
/* ======================================================== */
const storyPlayer=document.getElementById("storyPlayer");
const storyImg=document.getElementById("storyImg");
const storyHint=document.getElementById("storyHint");
const gameArea=document.getElementById("gameArea");

let storyList=[];
let storyIndex=0;
let storyCallback=null;

function playStory(images, finalHintColor, callback){
  storyList=images;
  storyIndex=0;
  storyCallback=callback;
  storyHint.style.color=finalHintColor?finalHintColor:"white";
  storyImg.src=storyList[0];
  storyPlayer.style.display="flex";
  gameArea.style.display="none";
}

storyPlayer.onclick=()=>{
  storyIndex++;
  if(storyIndex>=storyList.length){
    storyPlayer.style.display="none";
    if(storyCallback) storyCallback();
    return;
  }

  storyImg.src=storyList[storyIndex];

  if(storyIndex===storyList.length-1){
    storyHint.textContent="é»æ“Šä»»æ„åœ°æ–¹å†ä¸€æ¬¡";
  }else{
    storyHint.textContent="é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ";
  }
};

/* ======================================================== */
/*                     éŠ æˆ² åŸ æœ¬ ä»£ ç¢¼                    */
/* ======================================================== */
let level=1,lives=3,jokerSide="A",lock=false;

const JOKER_IMAGES=[
  "joker/1.png","joker/1000018658.jpeg","joker/1000018659.jpeg","joker/2.png",
  "joker/3.png","joker/4 (2).png","
