<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>çŒœçŒœå°ä¸‘åœ¨å“ªè£¡</title>

<style>
:root{
  --bg:#bfe8ff;
  --door:#3aa0ff;
  --accent:#ff4b6e;
  --text:#002d59;
  --red:#ff3b3b;
  --win:#1E90FF;
}
html,body{height:100%; margin:0; font-family:"Microsoft JhengHei",sans-serif; background:var(--bg); overflow:hidden;}

/* ====== é–‹å ´ï¼ˆå…¨è¢å¹•ï¼‰ ====== */
#storyIntro{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:99999;
}
#storyImg{
  width:100vw;
  height:100vh;
  object-fit:cover;
  display:block;
}
#storyHint{
  position:absolute;
  right:30px;
  top:50%;
  transform:translateY(-50%);
  writing-mode:vertical-rl;
  color:black;
  font-size:28px;
  user-select:none;
  background:rgba(255,255,255,0.0);
  padding:6px;
}

/* ====== GAME OVER / WIN å¾Œçš„å…¨è¢å¹•åºåˆ— ====== */
#postSeq{
  position:fixed;
  inset:0;
  background:black;
  display:none;
  justify-content:center;
  align-items:center;
  z-index:100000;
}
#postImg{
  width:100vw;
  height:100vh;
  object-fit:cover;
}
#postHint{
  position:absolute;
  right:30px;
  top:50%;
  transform:translateY(-50%);
  writing-mode:vertical-rl;
  color:black;
  font-size:28px;
  user-select:none;
  padding:6px;
}

/* ====== éŠæˆ²æœ¬é«” ====== */
.game-wrap{min-height:100vh; display:flex; flex-direction:column; align-items:center; padding:28px; gap:18px;}
header{width:100%; display:flex; justify-content:center; position:relative;}
h1{margin:0;font-size:28px;}
.level-badge{position:absolute; left:18px; top:0; padding:6px 10px; border-radius:10px;
  font-weight:700; background:rgba(255,255,255,0.25); backdrop-filter: blur(4px);}
.lives{position:absolute; right:18px; top:0; display:flex; gap:8px;}
.life{width:18px; height:18px; border-radius:50%; background:var(--red);}
.life.empty{background:#eee; border:1px solid #aaa;}

.stage{display:flex; gap:32px; justify-content:center; margin-top:20px;}

.door-card{
  width:540px; height:420px; background:var(--door);
  border-radius:16px; position:relative; overflow:hidden; cursor:pointer;
  transition:0.2s;
}

@keyframes shake {
  0%{ transform:translateX(0);}
  20%{ transform:translateX(-12px);}
  40%{ transform:translateX(12px);}
  60%{ transform:translateX(-8px);}
  80%{ transform:translateX(8px);}
  100%{ transform:translateX(0);}
}
.shake{ animation:shake 0.4s ease; }

.reveal-area{position:absolute; inset:0; z-index:1; display:flex; justify-content:center; align-items:center;}
.reveal-img{max-width:100%; max-height:100%; object-fit:cover;}

.panel{position:absolute; z-index:10; width:50%; top:0; bottom:0; display:flex;
  justify-content:center; align-items:center; font-size:60px; font-weight:900;
  background:var(--door); transition:0.75s;}
.panel.left{ left:0; }
.panel.right{ right:0; }
.door-card.open .panel.left{ transform:translateX(-100%); }
.door-card.open .panel.right{ transform:translateX(100%); }

.pop-clown{
  position:fixed;
  left:50%; top:50%;
  transform:translate(-50%,-50%) scale(0.1);
  font-size:40px;
  opacity:0.2;
  z-index:9999;
  animation:pop 0.9s ease-out forwards;
}
@keyframes pop {
  0% { transform:translate(-50%,-50%) scale(0.1); opacity:0; }
  40%{ transform:translate(-50%,-50%) scale(3.0); opacity:0.7; }
  100%{ transform:translate(-50%,-50%) scale(4.0); opacity:0; }
}

.overlay{position:fixed; inset:0; display:flex; justify-content:center;
  align-items:center; background:rgba(0,0,0,0); pointer-events:none;
  z-index:999; transition:0.3s;}
.overlay-message{opacity:0; font-size:70px; font-weight:900; color:red; transition:0.3s;}
.overlay.show{background:rgba(0,0,0,0.65); pointer-events:auto;}
.overlay.show .overlay-message{opacity:1;}
</style>
</head>

<body>

<!-- ====== é–‹å ´æ•…äº‹æ’­æ”¾ï¼ˆ1~6ï¼Œå…¨è¢å¹•ï¼‰ ====== -->
<div id="storyIntro" aria-hidden="false" role="dialog">
  <img id="storyImg" src="">
  <div id="storyHint">é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ</div>
</div>

<!-- ====== GAME OVER / WIN å¾Œçš„åºåˆ—å®¹å™¨ï¼ˆæœƒå‹•æ…‹æ”¾å…¥ä¸åŒå¼µæ•¸ï¼‰ ====== -->
<div id="postSeq" aria-hidden="true" role="dialog">
  <img id="postImg" src="">
  <div id="postHint">é»æ“Šä»»æ„åœ°æ–¹åœ¨ä¸€æ¬¡</div>
</div>

<!-- ====== éŠæˆ²æœ¬é«”ï¼ˆåŸæ¨£ä¿ç•™ï¼‰ ====== -->
<div class="game-wrap" id="gameArea" style="display:none;">
  <header>
    <div class="level-badge" id="levelBadge">ç¬¬1é—œ</div>
    <h1>çŒœçŒœå°ä¸‘åœ¨å“ªè£¡</h1>
    <div class="lives">
      <div class="life" id="life1"></div>
      <div class="life" id="life2"></div>
      <div class="life" id="life3"></div>
    </div>
  </header>

  <div class="stage">
    <div class="door-card" id="doorA">
      <div class="reveal-area"><img id="imgA" class="reveal-img"></div>
      <div class="panel left">ğŸ¤¡</div>
      <div class="panel right">ğŸ¤¡</div>
    </div>
    <div class="door-card" id="doorB">
      <div class="reveal-area"><img id="imgB" class="reveal-img"></div>
      <div class="panel left">ğŸ¤¡</div>
      <div class="panel right">ğŸ¤¡</div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-message" id="overlayMsg">GAME OVER</div>
</div>

<script>
/* ====== é–‹å ´æ•…äº‹æ’­æ”¾é‚è¼¯ï¼ˆ1~6ï¼Œä¾åºï¼Œå…¨è¢å¹•ï¼‰ ====== */
const storyImgsIntro=[
  "story/æ´‹èŠ‹ç‰‡1.jpg",
  "story/æ´‹èŠ‹ç‰‡2.jpg",
  "story/æ´‹èŠ‹ç‰‡3.jpg",
  "story/æ´‹èŠ‹ç‰‡4.jpg",
  "story/æ´‹èŠ‹ç‰‡5.jpg",
  "story/æ´‹èŠ‹ç‰‡6.jpg"
];

let storyIndex=0;
const storyIntro=document.getElementById("storyIntro");
const storyImg=document.getElementById("storyImg");
const storyHint=document.getElementById("storyHint");
storyImg.src=storyImgsIntro[0];

// é»æ“Šé–‹å ´åœ– â†’ åˆ‡ä¸‹ä¸€å¼µï¼Œæœ€å¾Œä¸€å¼µé»æ“ŠçµæŸé–‹å ´ä¸¦é¡¯ç¤ºéŠæˆ²
storyIntro.onclick = (e) => {
  storyIndex++;
  if (storyIndex < storyImgsIntro.length) {
    storyImg.src = storyImgsIntro[storyIndex];
  } else {
    // éš±è—é–‹å ´ï¼Œé¡¯ç¤ºéŠæˆ²
    storyIntro.style.display = "none";
    document.getElementById("gameArea").style.display = "flex";
    // ç¢ºä¿èƒ½è¦‹åˆ°æ¸¸æ¨™èˆ‡æ»¾å‹•ï¼ˆéŠæˆ²ç”¨ï¼‰
    document.body.style.overflow = "hidden";
  }
};

/* ====== POST-SEQUENCEï¼ˆGAME OVER / WINï¼‰é‚è¼¯ ======
   showPostSequence(type) æœƒé¡¯ç¤ºä¸€é€£ä¸²åœ–ç‰‡ï¼š
   - type === "gameover" -> images: 7,8,9
   - type === "win" -> images: 8,9
   æœ€å¾Œä¸€å¼µï¼ˆè‹¥æ˜¯æ´‹èŠ‹ç‰‡9ï¼‰å³å´å­—ç‚ºç™½è‰²ï¼Œæ–‡å­—ç‚º "é»æ“Šä»»æ„åœ°æ–¹åœ¨ä¸€æ¬¡"
   é»æ“Šæœ€å¾Œä¸€å¼µæœƒé‡æ–°è¼‰å…¥é é¢ï¼ˆå›åˆ°é–‹å ´ï¼‰
*/
const postSeq = document.getElementById("postSeq");
const postImg = document.getElementById("postImg");
const postHint = document.getElementById("postHint");

function showPostSequence(type){
  let seq = [];
  if(type === "gameover"){
    seq = [
      "story/æ´‹èŠ‹ç‰‡7.jpg",
      "story/æ´‹èŠ‹ç‰‡8.jpg",
      "story/æ´‹èŠ‹ç‰‡9.jpg"
    ];
  } else if(type === "win"){
    seq = [
      "story/æ´‹èŠ‹ç‰‡8.jpg",
      "story/æ´‹èŠ‹ç‰‡9.jpg"
    ];
  } else {
    return;
  }

  let idx = 0;
  // é¡¯ç¤ºå®¹å™¨
  postSeq.style.display = "flex";
  postSeq.setAttribute("aria-hidden","false");

  // åˆå§‹é¡¯ç¤ºç¬¬ä¸€å¼µ
  postImg.src = seq[0];
  // é è¨­æç¤ºï¼ˆéš±è—æˆ–é»‘è‰²ï¼‰
  postHint.style.color = "black";
  postHint.textContent = "é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ";

  // é»æ“Šåˆ‡æ›
  const clickHandler = () => {
    idx++;
    if(idx < seq.length){
      postImg.src = seq[idx];
      // è‹¥ç›®å‰æ˜¯æœ€å¾Œä¸€å¼µä¸”æ˜¯ æ´‹èŠ‹ç‰‡9ï¼ˆfilename å« 'æ´‹èŠ‹ç‰‡9'ï¼‰å°±æŠŠæç¤ºå­—æ”¹æˆç™½è‰²å­—ã€Œé»æ“Šä»»æ„åœ°æ–¹åœ¨ä¸€æ¬¡ã€
      if(seq[idx].includes("æ´‹èŠ‹ç‰‡9")){
        postHint.style.color = "white";
        postHint.textContent = "é»æ“Šä»»æ„åœ°æ–¹åœ¨ä¸€æ¬¡";
      } else {
        postHint.style.color = "black";
        postHint.textContent = "é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ";
      }
    } else {
      // æœ€å¾Œä¸€å¼µé»æ“Šå¾Œçš„è¡Œç‚ºï¼šé‡æ–°è¼‰å…¥æ•´å€‹é é¢ï¼ˆå›åˆ°é–‹å ´ä¸¦å¯å†ç©ï¼‰
      // é€™æ¨£ä¸æœƒæ”¹éŠæˆ²å…§éƒ¨é‚è¼¯ï¼Œåªæ˜¯é‡ç½®
      document.removeEventListener("click", clickHandler, true);
      postSeq.style.display = "none";
      postSeq.setAttribute("aria-hidden","true");
      // é‡æ–°è¼‰å…¥é é¢ä»¥å›åˆ°åŸå§‹ç‹€æ…‹
      location.reload();
    }
  };

  // ä½¿ç”¨æ•æ‰éšæ®µè¨»å†Šä»¥ç¢ºä¿èƒ½æ¥æ”¶åˆ°é»æ“Šï¼ˆå³ä½¿ overlay ç­‰è“‹ä½ï¼‰
  document.addEventListener("click", clickHandler, true);
}

/* ====== ä»¥ä¸‹å…¨éƒ¨ä¿æŒåŸéŠæˆ²ä¸è®Š ====== */

let level=1,lives=3,jokerSide="A",lock=false;

const JOKER_IMAGES=[
  "joker/1.png","joker/1000018658.jpeg","joker/1000018659.jpeg","joker/2.png",
  "joker/3.png","joker/4 (2).png","joker/4.png","joker/5.png",
  "joker/546175134_1138063744950693_180659281319095751_n.jpg",
  "joker/Am I (1).jpg","joker/Am I (2).jpg","joker/Am I (3).jpg","joker/Am I (4).jpg",
  "joker/Am I.jpg","joker/I am joker. (1).jpg","joker/I am joker. (2).jpg",
  "joker/I am joker. (3).jpg","joker/I am joker. çš„è¤‡æœ¬ (1).jpg",
  "joker/I am joker..jpg","joker/I am joker..png",
  "joker/IMG_20250806_193336_118.jpg","joker/IMG_20251001_224237_440-removebg-preview.png",
  "joker/IMG_20251118_213550_407.jpg",
  "joker/unnamed (1).webp","joker/unnamed (2).webp","joker/unnamed (4).webp","joker/unnamed.webp",
  "joker/æœªå‘½åè¨­è¨ˆ.jpg","joker/æœªå‘½åè¨­è¨ˆ.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 231537.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 231953.png","joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232248.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232410.png","joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232433.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232449.png","joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 233008.png"
];
const FILLER_IMAGES=["wrong/Ri86b7h.jpg"];

const doorA=document.getElementById("doorA");
const doorB=document.getElementById("doorB");
const imgA=document.getElementById("imgA");
const imgB=document.getElementById("imgB");
const overlay=document.getElementById("overlay");
const overlayMsg=document.getElementById("overlayMsg");

function updateLives(){
  for(let i=1;i<=3;i++){
    const el=document.getElementById("life"+i);
    if(i<=lives) el.classList.remove("empty");
    else el.classList.add("empty");
  }
}

function preloadImage(src){
  return new Promise(resolve=>{
    const img=new Image();
    img.onload=()=>resolve(src);
    img.src=src;
  });
}

let nextImages={A:'',B:''};
async function setRandomImages(){
  jokerSide=Math.random()<0.5?"A":"B";
  const jokerImg=JOKER_IMAGES[Math.floor(Math.random()*JOKER_IMAGES.length)];
  const fillerImg=FILLER_IMAGES[0];

  if(jokerSide==="A"){ nextImages={A:jokerImg,B:fillerImg}; }
  else{ nextImages={A:fillerImg,B:jokerImg}; }

  await Promise.all([preloadImage(nextImages.A),preloadImage(nextImages.B)]);
  imgA.src=nextImages.A;
  imgB.src=nextImages.B;
}

function playCorrectEffect(){
  const pop=document.createElement("div");
  pop.className="pop-clown";
  pop.textContent="ğŸ¤¡";
  document.body.appendChild(pop);
  setTimeout(()=>pop.remove(),900);
}

function playWrongEffect(door){
  door.classList.add("shake");
  setTimeout(()=>door.classList.remove("shake"),400);
}

function showGameOver(){
  overlay.classList.add("show");
  overlayMsg.textContent="GAME OVER";
  overlayMsg.style.color="red";

  // é¡¯ç¤ºå®Œ overlay å¾Œï¼Œå‘¼å« post-sequenceï¼ˆ7,8,9ï¼‰
  // æˆ‘æŠŠåºåˆ—é¡¯ç¤ºæ”¾åœ¨ä¸‹ä¸€å€‹ event loopï¼Œä»¥ç¢ºä¿ overlay å…ˆé¡¯ç¤º
  setTimeout(()=>{ showPostSequence("gameover"); }, 300);
}

function showWin(){
  overlay.classList.add("show");
  overlayMsg.textContent="WIN";
  overlayMsg.style.color="var(--win)";

  // é¡¯ç¤ºå®Œ overlay å¾Œï¼Œå‘¼å« post-sequenceï¼ˆ8,9ï¼‰
  setTimeout(()=>{ showPostSequence("win"); }, 300);
}

function clickDoor(side){
  if(lock) return;
  lock=true;

  const door=side==="A"?doorA:doorB;
  const correct=(side===jokerSide);

  door.classList.add("open");

  if(correct){
    playCorrectEffect();
  }else{
    playWrongEffect(door);
  }

  setTimeout(()=>{
    door.classList.remove("open");

    setTimeout(async()=>{
      if(!correct){
        lives--;
        updateLives();
        if(lives<=0){ showGameOver(); return; }
      }

      level++;
      if(level>6){ showWin(); return; }

      document.getElementById("levelBadge").textContent=`ç¬¬${level}é—œ`;
      await setRandomImages();
      lock=false;
    },750);

  },800);
}

doorA.onclick=()=>clickDoor("A");
doorB.onclick=()=>clickDoor("B");

updateLives();
setRandomImages();
</script>

</body>
</html>
