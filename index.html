<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>猜猜小丑在哪裡</title>
<style>
:root{
  --bg:#bfe8ff;
  --door:#3aa0ff;
  --door-front:#2a84d6;
  --accent:#ff4b6e;
  --text:#002d5a;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  user-select:none;
}
header{margin-top:18px;text-align:center;}
h1{margin:0;font-size:28px;}
.stage-container{
  position:relative; width:100%; display:flex; justify-content:center;
}
.topLeft{
  position:absolute; top:10px; left:10px; font-weight:800; font-size:20px;
  background: rgba(255,255,255,0.6); padding:6px 12px; border-radius:10px;
}
.topRight{
  position:absolute; top:10px; right:10px; display:flex; gap:8px; align-items:center;
}
.lifeDot{width:28px;height:28px;border-radius:50%;background:var(--accent);}
.lifeDot.hidden{opacity:0.15;}

.stage{ width:92%; max-width:980px; display:flex; flex-direction:column; align-items:center; gap:18px; margin-bottom:40px; }

.doors{ display:flex; gap:36px; justify-content:center; align-items:flex-start; width:100%; }

.doorWrap{ width:520px; height:360px; perspective:1200px; position:relative; }

.doorFront{
  width:100%; height:100%; border-radius:18px;
  background:linear-gradient(180deg,var(--door-front),var(--door));
  display:flex; justify-content:center; align-items:center;
  transform-origin: top center;
  transform: rotateX(0deg);
  transition: transform 1.8s cubic-bezier(.2,.8,.2,1);
  position:absolute; top:0; left:0; z-index:5;
}
.dotMark{
  width:60px;height:60px;border-radius:50%;
  background:var(--accent); display:flex;
  align-items:center; justify-content:center;
}
.doorBack{
  width:100%; height:100%; border-radius:18px;
  background:white; overflow:hidden;
  position:absolute; top:0; left:0; z-index:1;
}
.doorBack img{ width:100%; height:100%; object-fit:contain; display:block; padding:8px; visibility:hidden; }
.opened .doorFront{ transform: rotateX(-180deg); }

.overlay{
  position:fixed; left:0; top:0; right:0; bottom:0;
  background:rgba(255,255,255,0.97);
  display:none; justify-content:center; align-items:center;
  z-index:999; cursor:pointer;
}
.overlay.show{ display:flex; }
.overlay img{ width:100vw;height:100vh;object-fit:cover; }
.tapHint{ position:absolute; bottom:30px; background:white; padding:10px 20px; border-radius:8px; }

#endingScreen{
  position:fixed; left:0; top:0; right:0; bottom:0;
  display:none; justify-content:center; align-items:center;
  background:var(--bg); z-index:2000; cursor:pointer;
}
#endingScreen.show{ display:flex; }
#endingText{
  font-size:110px; font-weight:900; color:red;
  text-shadow:0 0 12px rgba(0,0,0,0.6);
}
</style>
</head>
<body>
<header><h1>猜猜小丑在哪裡</h1></header>

<div class="stage-container">
  <div class="topLeft" id="roundNum">0</div>
  <div class="topRight" id="lives"></div>
</div>

<section class="stage" id="gameStage">
  <div class="doors">
    <div class="doorWrap" id="door0">
      <div class="doorBack"><img src=""></div>
      <div class="doorFront"><div class="dotMark"></div></div>
    </div>
    <div class="doorWrap" id="door1">
      <div class="doorBack"><img src=""></div>
      <div class="doorFront"><div class="dotMark"></div></div>
    </div>
  </div>
</section>

<div class="overlay" id="overlay">
  <img id="storyImg">
  <div class="tapHint">點擊任意位置繼續</div>
</div>

<div id="endingScreen"><div id="endingText"></div></div>

<script>
// ====== 資源 ======
const storyStart=["./story/洋芋片1.jpg","./story/洋芋片2.jpg","./story/洋芋片3.jpg","./story/洋芋片4.jpg","./story/洋芋片5.jpg","./story/洋芋片6.jpg"];
const storyWin  =["./story/洋芋片8.jpg","./story/洋芋片9.jpg"];
const storyLose =["./story/洋芋片7.jpg","./story/洋芋片8.jpg","./story/洋芋片9.jpg"];

const correctImages=[
  "./joker/1.png","./joker/1000018658.jpeg","./joker/1000018659.jpeg",
  "./joker/2.png","./joker/3.png","./joker/4.png",
  "./joker/Am I (1).jpg","./joker/Am I (2).jpg","./joker/Am I (3).jpg",
  "./joker/I am joker..jpg","./joker/IMG_20251118_213550_407.jpg"
];
const wrongImage="./wrong/Ri86b7h.jpg";

// ====== 狀態 ======
let round=0, lives=3, busy=false, currentCorrectDoor=0;

const doors=[document.getElementById("door0"),document.getElementById("door1")];
const roundNumEl=document.getElementById("roundNum");
const livesEl=document.getElementById("lives");
const gameStage=document.getElementById("gameStage");
const overlay=document.getElementById("overlay");
const storyImg=document.getElementById("storyImg");
const endingScreen=document.getElementById("endingScreen");
const endingText=document.getElementById("endingText");

// ====== UI ======
function renderRound(){ roundNumEl.textContent=round; }
function renderLives(){
  livesEl.innerHTML="";
  for(let i=0;i<3;i++){
    const d=document.createElement("div");
    d.className="lifeDot" + (i<lives?"":" hidden");
    livesEl.appendChild(d);
  }
}

// ====== 最重要的修正：門關起後才換圖片 ======
function prepareImages(){
  // 先把圖片塞到門後，但保持看不到（visibility: hidden）
  currentCorrectDoor=Math.random()<0.5?0:1;
  const good=doors[currentCorrectDoor].querySelector("img");
  const bad =doors[1-currentCorrectDoor].querySelector("img");

  good.src=correctImages[Math.floor(Math.random()*correctImages.length)];
  bad.src=wrongImage;

  good.style.visibility="hidden";
  bad.style.visibility="hidden";
}

// ====== 開門 ======
function openDoor(idx){
  if(busy) return;
  busy=true;

  const door=doors[idx];
  const img =door.querySelector("img");

  // 動畫：開始開門
  door.classList.add("opened");

  // 1.2 秒後門翻到一半 → 顯示圖片
  setTimeout(()=>{ img.style.visibility="visible"; },1200);

  const isWrong=img.src.includes("wrong/");
  if(isWrong) lives--;

  renderLives();

  // 等門完全翻完
  setTimeout(()=>{

    if(isWrong && lives<=0){
      showEnding("GAME OVER",()=>{
        round=0; lives=3;
        showStory(storyLose, setupRound);
      });
    }
    else if(!isWrong && round>=6){
      showEnding("WIN",()=>{
        round=0; lives=3;
        showStory(storyWin, setupRound);
      });
    }
    else{
      setupRound();
    }

  },2000);
}

// ====== 每回合 ======
function setupRound(){
  round++; renderRound(); renderLives();
  busy=false;

  // 門關起來
  doors.forEach(d=>{
    d.classList.remove("opened");
  });

  // **門完全關好後**再換下一張（這就是你要的）
  setTimeout(()=>{
    prepareImages();
  },300); 
}

// ====== 劇情 ======
function showStory(arr, callback){
  gameStage.style.display="none";
  overlay.classList.add("show");

  let i=0;
  storyImg.src=arr[i];

  overlay.onclick=function(){
    i++;
    if(i>=arr.length){
      overlay.classList.remove("show");
      overlay.onclick=null;
      gameStage.style.display="flex";
      callback();
    }else{
      storyImg.src=arr[i];
    }
  }
}

// ====== 結局 ======
function showEnding(text, next){
  endingText.textContent=text;
  endingScreen.classList.add("show");
  endingScreen.onclick=function(){
    endingScreen.classList.remove("show");
    endingScreen.onclick=null;
    next();
  }
}

// ====== 遊戲開始 ======
doors.forEach((d,i)=>d.addEventListener("click",()=>openDoor(i)));

showStory(storyStart, setupRound);
</script>
</body>
</html>
