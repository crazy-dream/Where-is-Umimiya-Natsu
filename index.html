<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>çŒœçŒœå°ä¸‘åœ¨å“ªè£¡</title>
<style>
/* =============== åŸºæœ¬é‡ç½® =============== */
*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  padding:0;
  overflow:hidden; /* çµ•å°ç¦æ­¢æ²å‹•æ¢ */
  font-family:"Microsoft JhengHei", "PingFang TC", "Noto Sans TC", sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  background:var(--bg, #bfe8ff);
}

/* =============== è®Šæ•¸ =============== */
:root{
  --bg:#bfe8ff;
  --door:#3aa0ff;
  --door-front:#2a84d6;
  --accent:#ff4b6e;
  --text:#002d59;
  --red:#ff3b3b;
  --win:#1E90FF;
  --overlay-bg: rgba(0,0,0,0.65);
}

/* =============== æ•…äº‹æ’­æ”¾å™¨ï¼ˆå…¨è¢å¹• coverï¼‰ =============== */
#storyPlayer{
  position:fixed;
  inset:0;
  background:#000; /* é»‘åº•ï¼Œé¿å…è—è‰²å¤§æµ· */
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:99999;
  flex-direction:column;
  overflow:hidden;
}

#storyImg{
  width:100%;
  height:100%;
  object-fit:cover;
  background:#000;
  display:block;
}

/* å³å´ç›´æ’æç¤º */
#storyHint{
  position:absolute;
  right:20px;
  top:50%;
  transform:translateY(-50%);
  writing-mode:vertical-rl;
  font-size:28px;
  letter-spacing:4px;
  font-weight:700;
  opacity:0.9;
  color:#fff;
  text-shadow:0 2px 6px rgba(0,0,0,0.6);
  pointer-events:none;
}

/* ç•¶è¼‰å…¥å‡ºéŒ¯æ™‚çš„æç¤ºï¼ˆç½®æ–¼ä¸­é–“ï¼‰ */
#storyFallback{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  color:#fff;
  font-size:20px;
  text-align:center;
  display:none;
  z-index:100000;
}

/* =============== éŠæˆ²ä¸»é«” =============== */
.game-wrap{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:28px;
  gap:18px;
  background:var(--bg);
  overflow:hidden;
  z-index:1;
}

/* header */
header{
  width:100%;
  display:flex;
  justify-content:center;
  position:relative;
  align-items:center;
  height:64px;
}
h1{margin:0;font-size:28px;color:var(--text);}

/* é—œå¡å¾½ç«  */
.level-badge{
  position:absolute;
  left:18px;
  top:12px;
  padding:6px 10px;
  border-radius:10px;
  font-weight:700;
  background:rgba(255,255,255,0.25);
  backdrop-filter: blur(4px);
  color:var(--text);
  box-shadow:0 2px 6px rgba(0,0,0,0.08);
}

/* ç”Ÿå‘½ */
.lives{
  position:absolute;
  right:18px;
  top:12px;
  display:flex;
  gap:8px;
}
.life{
  width:18px;
  height:18px;
  border-radius:50%;
  background:var(--red);
  box-shadow:0 1px 2px rgba(0,0,0,0.2);
}
.life.empty{ background:#eee; border:1px solid #aaa; }

/* éŠæˆ²èˆå° */
.stage{
  display:flex;
  gap:32px;
  justify-content:center;
  margin-top:10px;
  align-items:center;
  flex:1;
  width:100%;
}

/* é–€å¡ */
.door-card{
  width:540px;
  height:420px;
  background:var(--door);
  border-radius:16px;
  position:relative;
  overflow:hidden;
  cursor:pointer;
  transition:transform 0.18s ease;
  box-shadow: 0 10px 30px rgba(0,0,0,0.12);
}
.door-card:active{ transform:scale(0.995); }

/* é–‹é–€å‹•ç•«ï¼ˆå·¦å³ panelï¼‰ */
.panel{
  position:absolute;
  z-index:10;
  width:50%;
  top:0;
  bottom:0;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:60px;
  font-weight:900;
  background:var(--door);
  transition:transform 0.75s;
}
.panel.left{ left:0; }
.panel.right{ right:0; }
.door-card.open .panel.left{ transform:translateX(-100%); }
.door-card.open .panel.right{ transform:translateX(100%); }

/* é¡¯ç¤ºåœ–åƒçš„å€åŸŸ */
.reveal-area{
  position:absolute;
  inset:0;
  z-index:1;
  display:flex;
  justify-content:center;
  align-items:center;
  background:transparent;
}
.reveal-img{
  max-width:100%;
  max-height:100%;
  object-fit:cover;
  display:block;
}

/* æŠ–å‹•æ•ˆæœ */
@keyframes shake {
  0%{ transform:translateX(0);}
  20%{ transform:translateX(-12px);}
  40%{ transform:translateX(12px);}
  60%{ transform:translateX(-8px);}
  80%{ transform:translateX(8px);}
  100%{ transform:translateX(0);}
}
.shake{ animation:shake 0.4s ease; }

/* å½ˆå‡ºå°ä¸‘ emoji */
.pop-clown{
  position:fixed;
  left:50%; top:50%;
  transform:translate(-50%,-50%) scale(0.1);
  font-size:40px;
  opacity:0.2;
  z-index:99999;
  animation:pop 0.9s ease-out forwards;
}
@keyframes pop {
  0% { transform:translate(-50%,-50%) scale(0.1); opacity:0; }
  40%{ transform:translate(-50%,-50%) scale(3.0); opacity:0.7; }
  100%{ transform:translate(-50%,-50%) scale(4.0); opacity:0; }
}

/* è¦†è“‹å±¤ & å¤§å­— WIN / GAME OVER */
.overlay{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0);
  pointer-events:none;
  z-index:99998;
  transition:background 0.3s;
  overflow:hidden;
}
.overlay-message{
  opacity:0;
  font-size:96px;
  font-weight:900;
  color:var(--red);
  transition:opacity 0.3s, transform 0.3s;
  transform:translateY(20px);
  text-align:center;
  text-shadow:0 10px 30px rgba(0,0,0,0.5);
}
.overlay.show{ background:var(--overlay-bg); pointer-events:auto; }
.overlay.show .overlay-message{ opacity:1; transform:translateY(0); }

/* å°å°ºå¯¸èª¿æ•´ */
@media (max-width:1200px){
  .door-card{ width:380px; height:300px; }
  .panel{ font-size:44px; }
  .overlay-message{ font-size:64px; }
}
@media (max-width:700px){
  header{ height:56px; }
  .stage{ flex-direction:column; gap:18px; padding-bottom:40px; }
  .door-card{ width:90%; height:40vh; max-height:360px; }
  #storyHint{ font-size:20px; right:12px; }
}
</style>
</head>
<body>

<!-- ======== æ•…äº‹æ’­æ”¾å™¨ï¼ˆå…¨è¢å¹• coverï¼‰ ======== -->
<div id="storyPlayer" aria-hidden="false" role="dialog" aria-label="æ•…äº‹æ’­æ”¾">
  <img id="storyImg" alt="æ•…äº‹åœ–ç‰‡">
  <div id="storyHint">é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ</div>
  <div id="storyFallback">æ•…äº‹åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèª /story è³‡æ–™å¤¾èˆ‡åœ–ç‰‡å­˜åœ¨ã€‚</div>
</div>

<!-- ======== éŠæˆ²ä¸»é«” ======== -->
<div class="game-wrap" id="gameArea" style="display:none;">
  <header>
    <div class="level-badge" id="levelBadge">ç¬¬1é—œ</div>
    <h1>çŒœçŒœå°ä¸‘åœ¨å“ªè£¡</h1>
    <div class="lives" aria-hidden="false">
      <div class="life" id="life1"></div>
      <div class="life" id="life2"></div>
      <div class="life" id="life3"></div>
    </div>
  </header>

  <div class="stage" role="main" aria-label="éŠæˆ²å€">
    <div class="door-card" id="doorA" tabindex="0" aria-label="é–€ A">
      <div class="reveal-area"><img id="imgA" class="reveal-img" alt="é–€ A å…§å®¹"></div>
      <div class="panel left">ğŸ¤¡</div>
      <div class="panel right">ğŸ¤¡</div>
    </div>

    <div class="door-card" id="doorB" tabindex="0" aria-label="é–€ B">
      <div class="reveal-area"><img id="imgB" class="reveal-img" alt="é–€ B å…§å®¹"></div>
      <div class="panel left">ğŸ¤¡</div>
      <div class="panel right">ğŸ¤¡</div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay" aria-hidden="true">
  <div class="overlay-message" id="overlayMsg">GAME OVER</div>
</div>

    <script>
/* ============================================================
   è³‡æ–™èˆ‡è¨­å®šï¼ˆåœ–ç‰‡è·¯å¾‘é™£åˆ—ï¼‰
   ============================================================ */
const introStory = [
  "story/æ´‹èŠ‹ç‰‡1.jpg",
  "story/æ´‹èŠ‹ç‰‡2.jpg",
  "story/æ´‹èŠ‹ç‰‡3.jpg",
  "story/æ´‹èŠ‹ç‰‡4.jpg",
  "story/æ´‹èŠ‹ç‰‡5.jpg",
  "story/æ´‹èŠ‹ç‰‡6.jpg"
];

const gameOverStory = ["story/æ´‹èŠ‹ç‰‡7.jpg","story/æ´‹èŠ‹ç‰‡8.jpg","story/æ´‹èŠ‹ç‰‡9.jpg"];
const winStory = ["story/æ´‹èŠ‹ç‰‡8.jpg","story/æ´‹èŠ‹ç‰‡9.jpg"];

const JOKER_IMAGES = [
  "joker/1.png","joker/1000018658.jpeg","joker/1000018659.jpeg","joker/2.png",
  "joker/3.png","joker/4 (2).png","joker/4.png","joker/5.png",
  "joker/546175134_1138063744950693_180659281319095751_n.jpg",
  "joker/Am I (1).jpg","joker/Am I (2).jpg","joker/Am I (3).jpg","joker/Am I (4).jpg",
  "joker/Am I.jpg","joker/I am joker. (1).jpg","joker/I am joker. (2).jpg",
  "joker/I am joker. (3).jpg","joker/I am joker. çš„è¤‡æœ¬ (1).jpg",
  "joker/I am joker..jpg","joker/I am joker..png",
  "joker/IMG_20250806_193336_118.jpg","joker/IMG_20251001_224237_440-removebg-preview.png",
  "joker/IMG_20251118_213550_407.jpg",
  "joker/unnamed (1).webp","joker/unnamed (2).webp","joker/unnamed (4).webp","joker/unnamed.webp",
  "joker/æœªå‘½åè¨­è¨ˆ.jpg","joker/æœªå‘½åè¨­è¨ˆ.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 231537.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 231953.png","joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232248.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232410.png","joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232433.png",
  "joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 232449.png","joker/è¢å¹•æ“·å–ç•«é¢ 2025-11-20 233008.png"
];

const FILLER_IMAGES = ["wrong/Ri86b7h.jpg"];

/* ============================================================
   DOM å…ƒç´ 
   ============================================================ */
const storyPlayer = document.getElementById("storyPlayer");
const storyImg = document.getElementById("storyImg");
const storyHint = document.getElementById("storyHint");
const storyFallback = document.getElementById("storyFallback");

const gameArea = document.getElementById("gameArea");
const doorA = document.getElementById("doorA");
const doorB = document.getElementById("doorB");
const imgA = document.getElementById("imgA");
const imgB = document.getElementById("imgB");

const overlay = document.getElementById("overlay");
const overlayMsg = document.getElementById("overlayMsg");
const levelBadge = document.getElementById("levelBadge");

/* ============================================================
   éŠæˆ²ç‹€æ…‹
   ============================================================ */
let storyIndex = 0;
let currentStory = introStory;
let storyMode = "intro"; // intro | gameover | win

let level = 1;
let lives = 3;
let lock = false;         // æ§åˆ¶é–€æ˜¯å¦å¯é»æ“Š
let jokerSide = "A";       // A or B
let nextImages = {A:'', B:''};

/* ============================================================
   é è¼‰å·¥å…·
   ============================================================ */
function preloadOne(src, timeout=6000){
  return new Promise((resolve,reject)=>{
    const img = new Image();
    let called = false;
    img.onload = ()=>{ if(!called){ called=true; resolve(src); } };
    img.onerror = ()=>{ if(!called){ called=true; reject(new Error("fail:"+src)); } };
    img.src = src;
    setTimeout(()=>{ if(!called){ called=true; reject(new Error("timeout:"+src)); } }, timeout);
  });
}
async function preloadList(list){
  return await Promise.all(list.map(p => preloadOne(p).then(()=>({src:p,ok:true})).catch(()=>({src:p,ok:false}))));
}

/* ============================================================
   æ•…äº‹æ’­æ”¾å™¨
   ============================================================ */
async function startIntroStory(){
  try{
    const res = await preloadList(introStory);
    const anyOk = res.some(r=>r.ok);
    if(!anyOk){
      storyFallback.style.display = "block";
      storyImg.style.display = "none";
    } else {
      storyFallback.style.display = "none";
      storyImg.style.display = "block";
      storyImg.src = introStory[0];
      updateHint(introStory[0]);
    }
  } catch(e){
    storyFallback.style.display = "block";
    storyImg.style.display = "none";
  }
  storyPlayer.onclick = handleStoryClick;
}

function updateHint(imgSrc){
  storyHint.textContent = "é»æ“Šä»»æ„åœ°æ–¹ç¹¼çºŒ";
  storyHint.style.color = "white";
}

function handleStoryClick(){
  storyIndex++;
  if(storyImg.style.display === "none"){
    storyPlayer.style.display = "none";
    showGameArea();
    return;
  }
  if(storyIndex >= currentStory.length){
    storyPlayer.style.display = "none";
    showGameArea();
    return;
  }
  storyImg.src = currentStory[storyIndex];
  updateHint(currentStory[storyIndex]);
}

/* ============================================================
   éŠæˆ²å‡½å¼
   ============================================================ */
function updateLives(){
  for(let i=1;i<=3;i++){
    const el = document.getElementById("life"+i);
    if(i<=lives) el.classList.remove("empty");
    else el.classList.add("empty");
  }
}

async function setRandomImages(){
  jokerSide = Math.random() < 0.5 ? "A" : "B";
  const jokerImg = JOKER_IMAGES[Math.floor(Math.random()*JOKER_IMAGES.length)];
  const fillerImg = FILLER_IMAGES[0] || "";
  if(jokerSide==="A") nextImages={A:jokerImg,B:fillerImg};
  else nextImages={A:fillerImg,B:jokerImg};
  try{
    await Promise.all([
      preloadOne(nextImages.A).catch(()=>{nextImages.A=fillerImg;}),
      preloadOne(nextImages.B).catch(()=>{nextImages.B=fillerImg;})
    ]);
  } catch(e){}
  imgA.src = nextImages.A;
  imgB.src = nextImages.B;
}

function playCorrectEffect(){
  const pop = document.createElement("div");
  pop.className="pop-clown";
  pop.textContent="ğŸ¤¡";
  document.body.appendChild(pop);
  setTimeout(()=>pop.remove(),900);
}

function playWrongEffect(door){
  door.classList.add("shake");
  setTimeout(()=>door.classList.remove("shake"),400);
}

function showGameOver(){
  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden","false");
  overlayMsg.textContent="GAME OVER";
  overlayMsg.style.color="red";
  setTimeout(()=>{playStory(gameOverStory,"gameover");},1200);
}

function showWin(){
  overlay.classList.add("show");
  overlay.setAttribute("aria-hidden","false");
  overlayMsg.textContent="WIN";
  overlayMsg.style.color="var(--win)";
  setTimeout(()=>{playStory(winStory,"win");},1200);
}

/* ============================================================
   ä¿®æ­£ cooldownï¼šé–€é—œé–‰å¾Œå°±ç«‹å³è§£é™¤ lock
   ============================================================ */
function clickDoor(side){
  if(lock) return;
  lock=true;

  const doorEl = (side==="A")?doorA:doorB;
  const correct = (side===jokerSide);

  doorEl.classList.add("open");
  if(correct) playCorrectEffect();
  else playWrongEffect(doorEl);

  // é–€é–‹é—œå‹•ç•«æœŸé–“ä»ç¶­æŒ lockï¼Œé—œé–€å¾Œç«‹å³è§£é™¤ lock
  setTimeout(async ()=>{
    doorEl.classList.remove("open");

    // ç­‰é–€å‹•ç•«çµæŸå¾Œç«‹å³å¯é»æ“Šä¸‹ä¸€æ¬¡
    if(!correct){
      lives--;
      updateLives();
      if(lives<=0){ showGameOver(); return; }
    }

    level++;
    if(level>6){ showWin(); return; }
    levelBadge.textContent=`ç¬¬${level}é—œ`;
    await setRandomImages();
    lock=false;
  }, 800);
}

/* ============================================================
   éŠæˆ²å•Ÿå‹•
   ============================================================ */
async function showGameArea(){
  level=1; lives=3; lock=false; levelBadge.textContent=`ç¬¬${level}é—œ`;
  updateLives();
  gameArea.style.display="flex";
  await setRandomImages();
  lock=false;
}

/* ============================================================
   story æ’­æ”¾å™¨ï¼ˆgameover / win ä¹Ÿå¯ç”¨ï¼‰
   ============================================================ */
function playStory(list, mode){
  currentStory=list.slice();
  storyMode=mode||"intro";
  storyIndex=0;
  preloadList(currentStory).then(res=>{
    const anyOk=res.some(r=>r.ok);
    if(!anyOk){ storyFallback.style.display="block"; storyImg.style.display="none"; }
    else{ storyFallback.style.display="none"; storyImg.style.display="block"; storyImg.src=currentStory[0]; }
  }).catch(()=>{ storyFallback.style.display="block"; storyImg.style.display="none"; });
  storyPlayer.style.display="flex";
  storyPlayer.onclick=()=>{
    storyIndex++;
    if(storyIndex>=currentStory.length){
      if(storyMode==="intro"){ storyPlayer.style.display="none"; showGameArea(); }
      else location.reload();
      return;
    }
    if(storyImg.style.display!=="none"){ storyImg.src=currentStory[storyIndex]; updateHint(currentStory[storyIndex]); }
  };
}

/* ============================================================
   ç¶å®šé–€äº‹ä»¶ & éµç›¤
   ============================================================ */
doorA.addEventListener("click",()=>clickDoor("A"));
doorB.addEventListener("click",()=>clickDoor("B"));

document.addEventListener("keydown",(e)=>{
  const key=e.key.toLowerCase();
  if(storyPlayer.style.display!=="none") return;
  if(key==="a"||key==="1") clickDoor("A");
  if(key==="b"||key==="2") clickDoor("B");
  if(key==="enter") clickDoor(Math.random()<0.5?"A":"B");
});

/* ============================================================
   åˆå§‹
   ============================================================ */
(function init(){
  startIntroStory();
  preloadList(JOKER_IMAGES.slice(0,6).concat(FILLER_IMAGES).filter(Boolean)).catch(()=>{});
})();
</script>
</body>
</html>
